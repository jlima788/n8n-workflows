{
  "createdAt": "2025-07-25T14:40:13.086Z",
  "updatedAt": "2025-07-28T13:31:34.409Z",
  "id": "U6J34iGAyaW2mJcJ",
  "name": "Controle de Clientes - Sou Bruno Reis",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 8
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -688,
        208
      ],
      "id": "7036b42b-ace0-46ad-aa27-dfd92ea1fd0b",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1gzm1PwXIK1wHVZ0ej2YTbRlQKWyci8HMyJc_QyOsLNs",
          "mode": "list",
          "cachedResultName": "Controle de Clientes do Sou Bruno Reis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1gzm1PwXIK1wHVZ0ej2YTbRlQKWyci8HMyJc_QyOsLNs/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Controle",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1gzm1PwXIK1wHVZ0ej2YTbRlQKWyci8HMyJc_QyOsLNs/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -480,
        208
      ],
      "id": "c59b5976-92e7-4f51-b4f8-cf0a5f31b623",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "nfGoy3UranCgi3Hm",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const hoje = new Date();\nconst hojeStr = hoje.toISOString().split('T')[0];\nconst doisDias = new Date(hoje);\ndoisDias.setDate(hoje.getDate() + 2);\nconst doisDiasStr = doisDias.toISOString().split('T')[0];\n\nfunction formatarDataBRparaISO(dataBR) {\n  if (!dataBR) return null;\n  const [dia, mes, ano] = dataBR.split('/');\n  return `${ano}-${mes}-${dia}`;\n}\n\nreturn items.filter(item => {\n  const dataVencBR = item.json['Data de Vencimento'];\n  const status = item.json['Status'] || '';\n  const ultima = item.json['Última Mensagem'] || '';\n\n  if (!dataVencBR || !status) return false;\n\n  const dataVencISO = formatarDataBRparaISO(dataVencBR);\n  if (!dataVencISO) return false;\n\n  if (status.toUpperCase() !== 'ATIVO') return false;\n\n  if (dataVencISO === doisDiasStr && ultima !== 'lembrete') {\n    item.json.tipo = 'lembrete';\n    return true;\n  }\n  if (dataVencISO === hojeStr && ultima !== 'cobranca_hoje') {\n    item.json.tipo = 'cobranca_hoje';\n    return true;\n  }\n  if (dataVencISO < hojeStr && ultima !== 'cobranca_vencida') {\n    item.json.tipo = 'cobranca_vencida';\n    return true;\n  }\n\n  return false;\n});\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -272,
        208
      ],
      "id": "be10cc3a-44f8-4991-a1ac-64353f2a5294",
      "name": "Code",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://x2id7y0t-evolution.cloudfy.cloud/message/sendText/automacao-ia",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "g1G7Cbap17j91XD7reMbfPX3AHgW2I0h"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=\"{{ $('Get row(s) in sheet').item.json.Celular }}\""
            },
            {
              "name": "text",
              "value": "={{ \n  $json.tipo === 'lembrete' \n    ? `Assunto: Lembrete: finalize sua compra do Café com FX antes que o link expire ⏳\n\nOlá, ${$json.Nome}!\n\nNotamos que sua compra do Café com FX ainda não foi concluída, e o prazo para pagamento vence em 2 dias.\n\nPara garantir seu acesso ao conteúdo, finalize agora mesmo no link abaixo:\n👉 ${$json['Link Pagamento']}\n\nSe você já realizou o pagamento, pode desconsiderar esta mensagem 🙌\n\nQualquer dúvida ou dificuldade, estou à disposição:\n📧 brunodosreislima@yahoo.com.br\n\nAbraços,\nBruno Reis` \n    : $json.tipo === 'cobranca_hoje' \n      ? `Assunto: Última chance! Seu acesso ao Café com FX expira hoje 🚨\n\nOlá, ${$json.Nome}!\n\nHoje é o último dia para concluir o pagamento da sua compra do Café com FX.\n\nAcesse o link abaixo para finalizar e garantir seu acesso:\n👉 ${$json['Link Pagamento']}\n\nSe você já pagou, desconsidere esta mensagem 😊\nCaso contrário, essa é a sua última oportunidade antes do link expirar!\n\nSe precisar de ajuda, me chame:\n📧 brunodosreislima@yahoo.com.br\n\nAbraços,\nBruno Reis` \n      : `Seu acesso expirou. Deseja continuar? Renove aqui: ${$json['Link Pagamento']}` \n}}\n\n\n\n"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        128,
        208
      ],
      "id": "effbc312-e6cc-4924-b244-beb46ed4a774",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1gzm1PwXIK1wHVZ0ej2YTbRlQKWyci8HMyJc_QyOsLNs",
          "mode": "list",
          "cachedResultName": "Controle de Clientes do Sou Bruno Reis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1gzm1PwXIK1wHVZ0ej2YTbRlQKWyci8HMyJc_QyOsLNs/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Controle",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1gzm1PwXIK1wHVZ0ej2YTbRlQKWyci8HMyJc_QyOsLNs/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Celular": "={{ $('Get row(s) in sheet').item.json.Celular }}",
            "Última Mensagem": "={{ $('Code').item.json.tipo }}"
          },
          "matchingColumns": [
            "Celular"
          ],
          "schema": [
            {
              "id": "Nome",
              "displayName": "Nome",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "E-mail",
              "displayName": "E-mail",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Celular",
              "displayName": "Celular",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data de Pagamento",
              "displayName": "Data de Pagamento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Data de Vencimento",
              "displayName": "Data de Vencimento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Tipo Pagamento",
              "displayName": "Tipo Pagamento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Link Pagamento",
              "displayName": "Link Pagamento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Última Mensagem",
              "displayName": "Última Mensagem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Produto",
              "displayName": "Produto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        336,
        208
      ],
      "id": "6af487d9-ff09-4b9e-9d4d-a38fe0c56046",
      "name": "Update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "nfGoy3UranCgi3Hm",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        128,
        16
      ],
      "id": "677b912f-38e8-4ba6-9767-55b1fbbf4fb0",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9f762994-d30c-4cd2-bf80-456f6d24c0d2",
              "leftValue": "={{ $json }}",
              "rightValue": 0,
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -80,
        208
      ],
      "id": "b0599557-5478-4bf8-96b9-0cecba575cec",
      "name": "Verifica se tem algum item para enviar mensagem"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        544,
        208
      ],
      "id": "be8251a6-e2d8-40a5-a10d-be5d4c73ba23",
      "name": "No Operation, do nothing1"
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Verifica se tem algum item para enviar mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verifica se tem algum item para enviar mensagem": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Sao_Paulo",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": []
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "7dc1c968-9374-4aad-8ab5-5f715108c711",
  "triggerCount": 1,
  "tags": []
}